\documentclass[portrait,final,paperwidth=92cm, paperheight=152cm,  fontscale=0.277]{baposter}
%a0paper,
\usepackage{calc}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{relsize}
\usepackage{multirow}
\usepackage{rotating}
\usepackage{bm}
\usepackage{url}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage{multicol}
\usepackage{siunitx}
\usepackage{vwcol} 
\usepackage{varwidth}
\usepackage{tikz}
\usepackage{graphicx}
\graphicspath{{/home/nicole/Documents/presentations/ipac2018/logos}{/home/nicole/Documents/presentations/ipac2018/tba-ipac18}}
\usetikzlibrary{calc}
%\usepackage{times}
%\usepackage{helvet}
%\usepackage{bookman}
\usepackage{palatino}
\newcommand\Tstrut{\rule{0pt}{2.6ex}}         % = `top' strut

\newcommand{\captionfont}{\footnotesize}

\graphicspath{{images/}{../images/}}
\usepackage{tikz}
\usetikzlibrary{shapes.misc}
\usetikzlibrary{shapes,arrows,decorations.markings,shadows,positioning}
\usetikzlibrary{snakes,backgrounds,spy}
\usepackage{tcolorbox}
\newcommand{\SET}[1]  {\ensuremath{\mathcal{#1}}}
\newcommand{\MAT}[1]  {\ensuremath{\boldsymbol{#1}}}
\newcommand{\VEC}[1]  {\ensuremath{\boldsymbol{#1}}}
\newcommand{\Video}{\SET{V}}
\newcommand{\video}{\VEC{f}}
\newcommand{\track}{x}
\newcommand{\Track}{\SET T}
\newcommand{\LMs}{\SET L}
\newcommand{\lm}{l}
\newcommand{\PosE}{\SET P}
\newcommand{\posE}{\VEC p}
\newcommand{\negE}{\VEC n}
\newcommand{\NegE}{\SET N}
\newcommand{\Occluded}{\SET O}
\newcommand{\occluded}{o}
\renewcommand{\baselinestretch}{-1.5} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% Some math symbols used in the text
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Multicol Settings
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\columnsep}{1.5em}
\setlength{\columnseprule}{0mm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Save space in lists. Use this after the opening of the list
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\compresslist}{%
	\setlength{\itemsep}{1pt}%
	\setlength{\parskip}{0pt}%
	\setlength{\parsep}{0pt}%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Begin of Document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Here starts the poster
%%%---------------------------------------------------------------------------
%%% Format it to your taste with the options
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{silver}{cmyk}{0,0,0,0.3}
\definecolor{black}{cmyk}{0,0,0.0,1.0}
\definecolor{darkYellow}{cmyk}{0,0,1.0,0.5}
\definecolor{darkSilver}{cmyk}{0,0,0,0.1}

\definecolor{KTHBlue}{cmyk}{.71,.37,0.07,0}
\definecolor{KTHsilver}{cmyk}{0,0,0,0.35}
\definecolor{KTHbeige}{cmyk}{0,0.03,0.19,0.04}


\begin{poster}{
  % Poster Options
	% Show grid to help with alignment
	grid=false,
	columns=6,
	% Column spacing
	colspacing=1em,
	% Color style
	bgColorOne=white,
	bgColorTwo=white,
	borderColor=KTHBlue,
	headerColorOne=black,
	headerColorTwo=KTHBlue,
	headerFontColor=white,
	boxColorOne=white,
	boxColorTwo=KTHBlue,
	% Format of textbox
	textborder=roundedleft,
	% Format of text header
	eyecatcher=true,
	headerborder=closed,
	headerheight=0.085\textheight,
	%  textfont=\sc, An example of changing the text font
	headershape=roundedright,
	headershade=shadelr,
	headerfont=\Large\bf\textsc, %Sans Serif
	textfont={\setlength{\parindent}{0em}},
	boxshade=plain,
	%  background=shade-tb,
	background=plain,
	linewidth=2pt
}
% Eye Catcher
{
	
	%\makebox[3em][l]{
		
} %}
% Title
{\bf\textsc{Photoinjector Optimization \\ Studies at the AWA}}%\vspace{10em}}
% Authors
{\vspace{1em}
	N. Neveu\textsuperscript{1}, L. Spentzouris, Illinois Institute of Technology, Chicago, IL, USA \\
	J. Larson, J. G. Power, \textsuperscript{1}Argonne National  Laboratory, Lemont, IL, USA \\
    }
% University logo
{% The makebox allows the title to flow into the logo, this is a hack because of the L shaped logo.
	%\makebox[3em][r]{
		\includegraphics[height=9em]{logos/combo_logo}%}
}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{AWA Facility}{name=problem,column=0,row=0, span=2}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The Argonne Wakefield Accelerator (AWA) Facility houses two rf photoinjectors.
Simulation codes used for experiments at the AWA include: PARMELA, GPT, 
ASTRA, and more recently OPAL. 
The latter is the code used for all simulations in this 
study. 
We also take advantage of the computing resources provided
by the LCRC at ANL. Access to the 
Blues, and recently installed Bebop clusters has significantly
increased simulation productivity by providing the capability to run 
all simulations in parallel, and large optimization cases
on many cores.
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{Beam Line Layout}{name=beamline,column=2,row=0,span=4, bottomaligned=problem}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\centering
\begin{tikzpicture}[scale=0.8, text=black]
\input{THPMF049f1.tex}
\end{tikzpicture}	

Partial beam line layout at the AWA.

}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{Model Based Method: BOBYQA}{name=bob,column=0,below=problem, span=6}{%, bottomaligned=conclusion}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent
Last year, we began with the optimization of 
the high charge (\SI{40}{nC}) photoinjector at the AWA. 
The simulation model included the gun, two solenoids, 
and six accelerating cavities.
We choose ten variables for the optimization parameters: 
laser radius, laser full width half maximum, solenoid strength ($S_2$), 
gun cavity phase, and the six accelerating cavity phases ($\phi_{L_1}-\phi_{L_6}$).

The objectives were emittance, and bunch length at the entrance of the quads. 
We choose to use a local optimization method that is 
freely available in the NLOPT package. 
Bounded Optimization By Quadratic Approximation (BOBYA), 
is a model based and derivative-free method 
that builds a quadratic using the results of simulation evaluations. 
The next point to evaluate is chosen by minimizing the quadratic.
The initial probe of the parameter space was done with 1,000 random simulations.
Simulations with the best emittance and bunch length were chosen 
as starting points for ten BOBYQA runs.
These local optimization runs were carried out until they converged.
The results from all ten runs were used to form a Pareto front
comparing transverse emittance and bunch length. 
Details of this work were presented at IPAC'17.
\vspace{-1em}

\begin{center}
	\begin{minipage}{0.5\textwidth}
The initial results were promising, and attempts to measure
several points on the Pareto front took place.
Experimentally, some of the parameter values were found to 
be outside the normal operating conditions at the AWA.
Using this experience, a second round of optimization 
was done using the same procedure and method. The boundaries for the second
round of optimization work can be found in the table below.
Note that $\phi_L=[\phi_{L_1},\ldots,\phi_{L_6}]$.

Several key points were learned from this work:
\begin{itemize}
	\itemsep0em
	\item Varying the laser radius is unnecessary. 
	All points on the Pareto front	had a laser radius of \SI{9}{mm}, the maximum value (results of strong space charge).
	\item Phase boundaries were too large for gun and linac.
	\item Phase can be used for velocity bunching	
\end{itemize}
		
\vspace{3em}
		\begin{singlespace}
			\centering
			
			Parameter Bounds for Linac Optimization
			
			\begin{tabular}{ l *{3}{c}}
				\hline%\toprule
				\textbf{Variable} & \textbf{Range} & \textbf{Unit} \\
				\hline%\midrule
				Solenoid Strength & $ 50 \le S_2 \le 440$  & amps \\
				Phase of Gun & $-45 \le \phi_g \le 45$  & degrees \\
				Laser Radius  & $3.5 \le R \le 9$  & mm \\
				Laser FWHM & $1.5 \le T \le $10  & ps \\
				Cavity Phase & $-40 \le \phi_L \le 40$  & degrees \\
				\hline%\bottomrule	
			\end{tabular}
		\end{singlespace}
	\end{minipage}\hspace{1em}
	\begin{minipage}{0.48\textwidth}
		\centering
		\includegraphics[width=1\textwidth]{THPMF049f2}
		
		Pareto front for adjusted variable bounds at \SI{40}{nC}. 
	\end{minipage}
	
\end{center}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{Genetic Algorithm}{name=kicker,column=0,row=0,span=6, below=bob}{
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Genetic Algorithms (GAs) have been used successfully for over two decades
in the accelerator physics community.
They are used to tackle large multiobjective optimization problems on wide variety of machines.  
In general, this class of algorithms aims to mimic the natural selection 
process often seen in biology. In this way, there are several
steps that most GAs follow: 
\begin{center}

	\begin{minipage}{0.5\textwidth}
			\begin{enumerate}
			\itemsep0em
			\item Start with a finite population (simulation evaluations). This is the first generation.
			\item Decided which individuals (simulations) in the population 
			are the best based on a selection criteria.
			\item Mix the best individuals to generate new individuals (new generation).
			\item Repeat many times.
		\end{enumerate}
		There has been much research on how to implement these steps, 
		and what types of selection and mutation criteria should be used.
		We used the \mbox{NSGA-II} implementation in OPAL.
		To verify the model based method, a low fidelity model 
		of the photoinjector was used to do a quick comparison.
		The simulation time to two minutes. 
		The optimization variables (table above) 
		and objectives are these same as those given in the previous section.
		The boundaries were reduced based on the information 
		learned in the first round of optimization.
		
		\vspace{4em}
		
\begin{singlespace}
	\centering
		\begin{tabular}{ l *{3}{c}}
		\hline 
		\textbf{} & \textbf{Total Simulations} & \textbf{Core Hours}  \\ 
		\hline 
		Model Based & 2,393  & 80 \\
		GA, 25th Generation  & 3,200  & 107 \\
		GA, 500th Generation & 64,000 & 2,133 \\
		\hline%\bottomrule	
	\end{tabular}
	
\end{singlespace}

\vspace{1em}
	Comparison of the three Pareto fronts are similar.
	As expected by the "no free lunch" theorem, both methods give 
	acceptable results, with only the total simulation time being 
	the difference. 
	\end{minipage}	%\hspace{1em}
	\begin{minipage}{0.48\textwidth}
		\centering
		\includegraphics[width=1\textwidth]{THPMF049f3}
		
		Comparison of model based optimization and the GA implemented in OPAL at \SI{40}{nC}. 
	\end{minipage}
\end{center}

}

\iftrue
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{Future Work: Novel Methods}{name=work,column=0,above=bottom, span=3}{%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent 
We will take advantage of the 
open source Python library libensemble:
\begin{center}
	\url{https://github.com/Libensemble/libensemble}
\end{center} 
This framework allows for massively parallel ensemble simulations in 
combination with a mechanism for easily interchanging optimization methods. 
We will deploy Asynchronously Parallel Optimization Solver for finding Multiple Minima (APOSMM).
This multistart algorithm considers all results from previously evaluated simulations when determining where to start a local optimization run. 
This allows for an efficient search for a global minimum. 
This method has already been tested
(with success) on problems where derivatives are unavailable, 
as is the case here.	
	
}
\iffalse
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{Conclusion}{name=ref,column=2,above=bottom, span=2}{%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent 
Photoinjector optimization projects are ongoing at the AWA.
Two optimization methods have been used with success:
BOBYQA and NSGA-II. In the future, novel optimization 
methods developed at ANL will be tested. The first of 
which will be APOSMM. All optimization efforts aim to improve operating conditions at the AWA and 
aid in the completion of the beamline designs needed for upcoming experiments.

}
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\headerbox{Acknowlegements}{name=work,column=3,above=bottom, span=3, above=bottom, aligned=work}{%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\noindent 
We gratefully acknowledge the computing resources
provided on Bebop, a HPC cluster operated by the LCRC at ANL.
This work is supported by the U.S. DOE, OS,  
contract DE-AC02-06CH11357 and grant DE-SC0015479. 
Travel to IPAC'18 supported by the United States National Science Foundation, 
the Division of Physics of Beams of the American Physical Society, and TRIUMF.

\hfill
\begin{center}
	\includegraphics[width=0.15\textwidth]{logos/nsf}\hspace{1em}
\includegraphics[width=0.5\textwidth]{logos/DOE_logo_color_cmyk}\hspace{1em}
\includegraphics[width=0.15\textwidth]{logos/aps-logo}
\end{center}
}
\fi

\end{poster}%
%
\end{document}
